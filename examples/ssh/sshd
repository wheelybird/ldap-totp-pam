#%PAM-1.0
# PAM configuration for SSH with LDAP-backed TOTP
#
# Install this file to /etc/pam.d/sshd
#
# For SSH, use challenge-response mode for better UX.
# Users will be prompted separately for password and TOTP code.
#
# Also configure in /etc/ssh/sshd_config:
#   ChallengeResponseAuthentication yes
#   UsePAM yes
#   PasswordAuthentication no

# TOTP + LDAP authentication
auth required pam_ldap_totp.so forward_pass
auth required pam_ldap.so use_first_pass

# Standard account/session management
account required pam_unix.so
account required pam_ldap.so

session required pam_unix.so
session required pam_mkhomedir.so skel=/etc/skel umask=0077
session optional pam_ldap.so
